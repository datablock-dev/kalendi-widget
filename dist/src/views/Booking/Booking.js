import{__awaiter as e,__generator as r}from"../../../node_modules/tslib/tslib.es6.js";import a,{useState as t,useRef as l}from"react";import{v as n}from"../../../node_modules/validator/index.js";import{Button as s}from"../../components/Button.js";import{Input as c}from"../../components/Input.js";import i from"../../../node_modules/@mui/icons-material/Image.js";import"../KalendiSchedule/KalendiSchedule.js";function m(m){var o=m.backendRoute,d=m.data,p=m.services,u=m.selectedUser,f=m.selectedService,x=m.selectedDate,v=m.setView,b=m.setCustomerData,E=t(!1),g=E[0],_=E[1],N=t(!1),w=N[0],h=N[1],y=l(null),Y=l(null),j=p.find((function(e){return e.service_id===f})),D=d.find((function(e){return e.user_id===u}));if(!j||!D)return a.createElement("div",null,"Error...");function k(){if(!y.current||!Y.current)return _(!1);var e=y.current.value,r=Y.current.value;return n.isEmail(r)?e.length<2?_(!1):void _(!0):_(!1)}return a.createElement("div",{className:"w-[100%] h-[100%] flex flex-col"},a.createElement("div",{className:"flex flex-row gap-[6px] items-center mb-[10px]"},a.createElement("label",{className:"font-[600]"},"Date:"),a.createElement("div",{className:"flex flex-row items-center gap-[10px]"},a.createElement("span",{className:"bg-[#d4d4d4] rounded-[3px] px-[4px] py-[4px] border-[#7878785f] border-[1px] border-solid"},x.format("YYYY-MM-DD")),a.createElement("span",{className:"bg-[#d4d4d4] rounded-[3px] px-[4px] py-[4px] border-[#7878785f] border-[1px] border-solid"},x.format("HH:mm")),a.createElement("span",{className:"bg-[#d4d4d4] rounded-[3px] px-[4px] py-[4px] border-[#7878785f] border-[1px] border-solid"},x.add(j.service_time_block,"minutes").format("HH:mm")))),a.createElement("div",{className:"flex flex-row flex-wrap gap-[10px]"},a.createElement("div",{className:"flex flex-col items-center rounded-[3px] border-[#787878] border-[1px] border-solid sd:w-[100%] md:w-[min(calc(50%_-_5px),500px)] py-[10px]"},a.createElement("label",{className:"font-[600]"},"Service"),a.createElement("div",{className:"flex flex-row items-center gap-[10px]"},j.service_image?a.createElement("img",{className:"image-round",src:j.service_image?"".concat(o,"/upload/").concat(j.service_image):"",alt:"service_image"}):a.createElement("div",{className:"image-round text-[12px] flex items-center justify-center"},a.createElement(i,null)),a.createElement("span",null,j.service_name))),a.createElement("div",{className:"flex flex-col items-center rounded-[3px] border-[#787878] border-[1px] border-solid sd:w-[100%] md:w-[min(calc(50%_-_5px),500px)] py-[10px]"},a.createElement("label",{className:"font-[600]"},"Employee"),a.createElement("div",{className:"flex flex-row items-center gap-[10px]"},D.avatar?a.createElement("img",{className:"image-round",src:D.avatar?"".concat(o,"/upload/").concat(D.avatar):"",alt:"user_avatar"}):a.createElement("div",{className:"image-round text-[12px] flex items-center justify-center"},"N/A"),a.createElement("span",null,D.firstname," ",D.lastname)))),a.createElement("div",{className:"grid grid-cols-[repeat(2,calc(50%_-_5px))] gap-[10px] mt-[20px] sd:flex sd:flex-col sd:gap-[10px]"},a.createElement(c,{label:"Name",forwardRef:y,onChangeCallBack:k}),a.createElement(c,{label:"Email",type:"Email",forwardRef:Y,onChangeCallBack:k})),a.createElement(s,{text:"Book",callBack:function(){return e(this,void 0,void 0,(function(){var e,a,t,l;return r(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),j?y.current&&Y.current?(e=y.current.value,a=Y.current.value,n.isEmail(a)?e.length<2?[2,alert("Please provide a valid name value")]:(h(!0),d.find((function(e){return e.user_id===u&&e.service_id===f}))?(t={user_id:u,service_id:f,from_timestamp:x.format("YYYY-MM-DD HH:mm:ss"),to_timestamp:x.add(null==j?void 0:j.service_time_block,"minutes").format("YYYY-MM-DD HH:mm:ss"),customer:{name:e,email:a}},[4,fetch("".concat(o,"/public"),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)})]):[2,h(!1)]):[2,alert("Please provide a valid email address")]):[2,_(!1)]:[2];case 1:return r.sent(),b({name:e,email:a}),h(!1),v("confirmation"),[2];case 2:return l=r.sent(),console.error(l),[3,3];case 3:return[2]}}))}))},isClickable:g,isLoading:w,loadingColor:"#fff"}))}export{m as ConfirmBookingView};
